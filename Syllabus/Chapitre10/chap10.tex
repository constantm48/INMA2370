\ifx \globalmark \undefined %% This is default.
	\input{header}
	\begin{document} %% Crashes if put after (one of the many mysteries of LaTeX?).
\else 
	\documentclass{standalone}
	\begin{document}
\fi
\graphicspath{ {Chapitre10/images/} }

\setcounter{chapter}{9}
\chapter{Controllability and path planning}
\chaptermark{Commandabilit√© et planification de trajectoires}\label{complantraj}

\lettrine[lines=1]{\bf I}{}n the three precedents chapter, we have studied in detail the behavior of the {\it free} dynamic systems whose inputs are {\it constants}~: $\dot x = f(x,\bar u)$.
In this last chapter, we will consider {\it controlled} dynamic systems $\dot x = f(x,u)$ and we will be particularly interested in the existence and determination of input functions $u(t)$ that can vary with time and that allow to pilot the state system and to plan paths.

\section{Definitions}

In practice, it often happens that we desire to pilot a dynamic system from an initial state $x_0$ to a final state $x_f$. This is what we call a {\it path planning problem}. In order to solve such a problem, there must exist at least one input function that products a path of the system that goes through the states $x_0$ and $x_f$.

\begin{definition}{{\bf Reachable states}}

For the dynamic system $\dot x = f(x,u)$, the final state $x_f$ is reachable from the initial state $x_0$ if there exists a finite time $T$ and an input function $u(t) : [t_0,t_0 +T]
\rightarrow \mathbb{R}^n$ such as $x(t_0+T,x_0,u) = x_f$.
\qed
\end{definition} 
This notion of reachability leads to the concept of controllability of a dynamic system as explained in the following definition.\\\\\\

\begin{definition}{{\bf Controllability}}

The system $\dot x = f(x,u)$ is {\it locally controllable} in $x_f$ if there exists a neighbourhood of $x_f$ such that $x_f$ is reachable from each element in the neighbourhood.

The system is {\it globally controllable} if each state $x_f \in \mathbb{R}^n$ is reachable from each initial state $x_0 \in \mathbb{R}^n$.
\qed
\end{definition}
The subject of this chapter is to study the controllability and the path planning of the dynamic systems $\dot x = f(x,u)$. As we will see, the analysis of the reachability and of the controllability is completely elucidated for linear systems though a lot of open questions remain for non-linear systems. On the other hand, the problem of path planning is completely solved for linear systems, while we only know the solution for a restricted class of non-linear systems that we call {\it (differentially) flat system} and that are, in a sense, equivalents to linear systems.

\section{Controllability: linear systems}

In order to check if a linear system $\dot x = Ax + Bu$ is completely controllable, we can use one of the two criterion given by the following theorem.
\begin{theoreme} {\bf Controllability of linear systems}
\label{linear}

The linear system $\dot x = Ax + Bu$ is completely controllable if and only if one of the two following criterion is satisfied~:
\begin{enumerate}
\item (Kalman's criterion) The matrix ${\cal C} = (B \hh AB \hh A^2B
\dots A^{(n-1)}B)$ is regular (this matrix is called {\it controllability matrix});
\item (Popov-Belevitch-Hautus's criterion) The rank of the matrix $(sI-A \hh B)$ is equal to $n$ for each $s \in {\mathbb {C}}$. \qed
\end{enumerate}
\end{theoreme}
If a linear system is not completely controllable, we can define a state transformation in order to bring the non-controllable part of the state vector out.\\
Let's suppose that the controllability matrix is of rank $d < n$. We can define a matrix $T = (T_a \hh T_b)$ such that $T_a$ contains $d$ linearly independent columns of $\cal C$ and $T_b$ completes the matrix by $n-d$ vectors independent of the columns of $T_a$. The inverse matrix $T^{-1}$ can be written~:
\eqnn
T^{-1} = \bma{c} U_a \\ U_b \ema
\eeqnn
where the matrix $U_a$ and $U_b$ are chosen such so that~:
\eqnn
T^{-1}T = \bma{cc} U_aT_a & U_aT_b \\ U_bT_a & U_bT_b \ema = 
\bma{cc} I_d & 0 \\ 0 & I_{n-d} \ema
\eeqnn
We define the state transformation~:
\eqnn
z = \bma{c} z_a \\ z_b \ema = \bma{c} U_ax \\ U_bx \ema
\eeqnn
In these new state variable, we have the following state model~:
\eqnn
\dot z_a &=& U_aAT_az_a + U_aAT_bz_b + U_aBu \\
\dot z_b &=& U_bAT_bz_b
\eeqnn
Indeed $U_bT_a=0$ implies that $U_bB = 0$ and $U_bAT_a=0$ because the columns of $B$ and $AT_a$ are linear combinations of the columns of $T_a$.
We notice thatthe part $z_b$ of the state vector isn't influenced by the input $u$~: it represents the non-controllable part of the system's state.

\section{Controllability: non-linear systems}

The study of the controllability of non-linear systems is far more complicated that the one of linear systems. We begin this study by examining the conclusion that we can get from the controllability of a linearised of a non-linear system in the neighbourhood of an equilibrium.

\begin{theoreme} {\bf Local controllability (1)}\label{linear}

Let's consider the linearised of the system $\dot x = f(x,u)$ around an equilibrium $(\bar x, \bar u)$~:
\eqn \label{lin}
\dot x = Ax +Bu \hd
\text{avec} \hd
A = ({\frac{\partial f}{\partial x}})_{(\bar x, \bar u)} \;\; \text{et} \;\; B = 
({\frac{\partial f}{\partial u}})_{(\bar x, \bar u)}.
\eeqn
If the linear system (\ref{lin}) is controllable, then, for each $\epsilon > 0$, all of the reachable states $x_f$ from $\bar x$ with inputs $u(t)$ : $u(t) - \bar u < \epsilon$, contains one neighbourhood of $\bar x$.
\qed

\end{theoreme}
This local property of controllability of non-linear systems has a limited range. A we will se in the following example, there are indeed completely controllable non-linear systems whose linearised is not completely controllable in the neighbourhood of an equilibrium !\\

\begin{exemple}{\bf A car} \label{voiture}

Let's consider an \og FWD \fg~car whose front wheels are director and driving wheels. The cinematic model is written~:
\eqnn
\dot \xi_1 &=& \sin \theta_1 \cos \theta_2 u_1 \\
\dot \xi_2 &=& -\cos \theta_1 \cos \theta_2 u_1 \\
\dot \theta_1 &=& \sin \theta_2 u_1 \\
\dot \theta_2 &=& u_2
\eeqnn
where $(\xi_1,\xi_2)$ are the cartesian coordinates of the middle of the back axle, $\theta_1$ is the orientation of the chassis $\theta_2$ is the front wheel orientation, $u_1$ is the propulsion speed and $u_2$ is the speed of the front wheels.
This system has an infinity of non-isolated equilibriums of the form $(\bar \xi_1, \bar \xi_2, \bar \theta_1,$ $\bar \theta_2, 0, 0)$. The matrices $(A,B)$ of the linearised of the system around any of these equilibrium are written~:
\eqnn
A = 0 \hu B = \bma{cc} \sin {\bar \theta_1} \cos {\bar \theta_2} & 0 \\
-\cos {\bar \theta_1} \cos {\bar \theta_2} & 0 \\
\sin {\bar \theta_2} & 0 \\ 0 & 1 \ema
\eeqnn
We notice immediately that the linearised system is not controllable (rank ${\cal C} = 2$) while the physical intuition obviously indicates that a car  is a controllable dynamic system which can be moved from any initial position to any final one in an obstacle-free environment.
\qed

\end{exemple}

As this example indicates it, a non-linear system can have controllability properties that are not apparent in the linearised. The analysis of the properties is eased by the use of concepts and notations of differential geometry which are briefly explained in the appendices. We begin their study with the presentation of a procedure that allows to bring the state variables out when a system is {\textit{not}} controllable.

Let's suppose that for a given system $\dot x = f(x,u)$, there exists a state transformation $z = \phi(x)$ such that, in the newstate variables, the system can be written as following~:
\eqnn
z = \bma{c} z_a \\ z_b \ema \hu 
\left \{
\begin{tabular}{ll}
$\dot z_a = \tilde f_a(z_a, z_b, u)$ \\
$\dot z_b = \tilde f_b(z_b)$ 
\end{tabular}
\right.
\eeqnn
It is clear, in this case that the part $z_b$ of the state vector isn't influenced by the input $u$ and that the system isn't completely controllable. Here is a simple example.

\begin{exemple}{\bf A chemical reactor}

Let's consider an isotherm chemical reactor that is perfectly mixed in which the following reversible reaction is happening~:
\eqnn
2X_1 \longleftrightarrow X_2 + X_3 
\eeqnn
The reactor is alimented by the specie $X_1$ with a constant volumetric flow rate and a variable concentration. The state model is written~: 
\eqnn
\dot x_1 &=& -2k_1x_1^2 + 2k_2x_2x_3 - dx_1 + du \\
\dot x_2 &=& k_1x_1^2 - k_2x_2x_3 - dx_2 \\
\dot x_3 &=& k_1x_1^2 - k_2x_2x_3 - dx_3
\eeqnn
Granted is the following linear state transformation~:
\eqnn
\begin{tabular}{lcl}
$z_1 = x_1$ &  & $x_1 = z_1$ \\
$z_2 = x_2$ & $\longleftrightarrow$  & $x_2 = z_2$ \\
$z_3 = x_2 - x_3 $ &  & $x_3 = z_2 - z_3$ 
\end{tabular}
\eeqnn
With the new state variables, the model is rewritten~;
\eqnn
\dot z_1 &=& -2k_1z_1^2 + 2k_2z_2(z_2 - z_3) - dz_1 + du \\
\dot z_2 &=& k_1z_1^2 - k_2z_2(z_2 - z_3) - dz_2 \\
\dot z_3 &=& -dz_3
\eeqnn
The system is not completely controllable because the paths of $z_3$ (which is the difference between the concentrations of the species $X_2$ and $X_3$) can not be influenced by the input $u$ (which is the alimentation concentration of the specie $X_1$.
\qed

\end{exemple}
A sufficient existence condition of the non-controllable part of the state is given in the following theorem for affine systems in the input~:
\eqn
\dot x = f(x) + \sum_{j=1}^m g_j(x)u_j \label{affine}
\eeqn
\begin{theoreme}

If, in the neighbourhood $U$ of a point $x_0$, there exists one regular distribution $\Delta(x)$ of dimension $d$ such that~:
\begin{enumerate}
\item $\Delta(x)$ is involutive
\item $\Delta(x)$ contains $\mbox{ span} \{ g_1(x), g_2(x), \dots
,g_m(x)\}$
\item $\Delta (x)$ is invariant with respect to $f(x)$ and $g_1(x), g_2(x), \dots
,g_m(x)$,
\end{enumerate}
then there exists a state transformation $\phi : U \longrightarrow
V=\phi(U)$ such that, with the new state variables $z=\phi(x)$, the system (\ref{affine}) is rewritten~:
\eqnn
\dot z_a &=& \tilde f_a(z_a, z_b) +  \sum_{j=1}^m \tilde g_j(z_a,
z_b)u_j\\ \dot z_b &=& \tilde f_b(z_b) 
\eeqnn
with dim $z_b = (n-d)$.
\qed

\end{theoreme}
The following theorem allows then to determine the smaller distribution $\Delta^*(x)$ that verifies the upper conditions and that allows to determine the maximum dimension of the non-controllable part.

\begin{theoreme} \label{procedure}

In a neighbourhood $U$ of $x_0$, the distributions sequence is defined~:
\eqnn
\Delta_0(x) &=& \mbox{ span} \{g_1(x), g_2(x), \dots , g_m(x) \} \\
\Delta_k(x) &=& \Delta_{k-1}(x) + [f(x),\Delta_{k-1}(x)] + 
\sum_{j=1}^m [g_j(x),\Delta_{k-1}(x)].
\eeqnn
Then $\Delta^*(x) = \Delta_{k^*}(x)$ with $k^*$ the smallest integer such that
$\Delta_{k^*}(x)$ is regular on $U$ and invariant with respect to $f(x)$
and $g_1(x), g_2(x), \dots ,g_m(x)$. If all distributions 
$\Delta_k(x), 0 \leq k \leq k^*$ are regular on $U$, then $k^* \leq n$.
\qed 
\end{theoreme}
The dimension of $\Delta^*$ is called the {\it reachability rank} of the 
system in the neighbourhood of $x_0$. The statement of the theorem 
\ref{procedure} implicitly contains a procedure for the determination of the 
reachability rank which consists of generating successively the distributions 
$\Delta_k (x)$. The procedure stops as soon as we find one that is regular
 and invariant with respect to $f$ and $ g_i$. There is no need to check 
that this distribution is involutive. It is also interesting to observe that in the 
case of a linear system $\dot x = Ax + Bu$, we have~:
\eqnn
\Delta_k = \mbox{ span }\{B \hh AB \dots A^{k-1}B \}
\eeqnn
and therefore that the reachability rank coincides with the rank of the controllability 
matrix ${\cal C}$.

A system whose reachability rank is maximum (i.e. equal to $n$) in the 
neighbourhood of $x_0$ then owns a property of local controllability similar 
to the one of theorem \ref{linear}, even if $x_0$ is not an equilibrium state 
and even if the linearized of the system is not controllable.

\begin{theoreme} {\bf Local controllability (2)}

For the system  (\ref{affine}), there exists a neighbourhood of $x_0$
in which all states are reachable from $x_0$ if and only if the reachability rank
 of the system in the neighbourhood of $x_0$ is equal to $n$.
\qed

\end{theoreme}

Finally we have the complete controllability property for a subclass of 
systems.

\begin{theoreme} {\bf Complete controllability}

If $f(x) \in \mbox{ span} \{g_1(x), g_2(x), \dots , g_m(x) \}$ for all 
$x \in \mathbb{R}^n$ (this is especially true if $f(x) = 0$) and if 
the reachability rank is $n$ in the neighbourhood of all  $x \in \mathbb{R}^n$,
then the system (\ref{affine}) is completely controllable.
\qed 
\end{theoreme}
These two theorems are illustrated in the following example.

\begin{exemple}{\bf A motor vehicle}

Let us consider again the model of the motor vehicle of the example \ref{voiture} which is writen~:
\eqnn
\dot x = g_1(x)u_1 + g_2(x)u_2
\eeqnn
with~:
\eqnn
g_1(x) = \bma{c} \sin \theta_1 \cos \theta_2 \\ 
-\cos \theta_1 \cos \theta_2 \\ \sin \theta_2 \\ 0 \ema \hu g_2(x) =
\bma{c} 0 \\ 0 \\ 0 \\ 1 \ema
\eeqnn
We calculate the Lie bracket~:
\eqnn
g_3(x) = [g_1(x),g_2(x)] &=& \bma{c} -\sin \theta_1 \sin \theta_2 \\ 
\cos \theta_1 \sin \theta_2 \\ \cos \theta_2 \\ 0 \ema \\
g_4(x) = [g_3(x),g_1(x)] &=& \bma{c} \cos \theta_1 \\ \sin \theta_1 \\ 0
\\0 \ema
\eeqnn
We can check that $f(x) = 0$ and that the matrix $[g_1(x), g_2(x), g_3(x),
g_4(x)]$ is regular for all $x$ in $\mathbb{R}^4$. These two conditions
are enough so that the assumptions of the two previous theorems 
are verified. The motor vehicle is therefore completely controllable even if its
linear model is not.
\qed 

\end{exemple} 
The results presented in this section can seem restrictive because 
they only can be applied to systems which are affine in the input.
Their reach is however more general because any given system 
 $\dot x = f(x,u)$ can always be increased by a {\it dynamic extension}
to return it affine in the input. It is indeed enough to consider $u$ as
an additional set of state variables and to define a new vector $v$ 
of input variables such as~: 
\eqnn \dot x &=& f(x,u) \\
\dot u &=& v
\eeqnn
With the augmented state vector $\xi^T = (x^T,u^T)$, the system is written~:
\eqn
&&\dot \xi = \varphi(\xi) + \sum_{j=1}^m g_jv_j = \varphi(\xi) +
Gv \label{augm}\\
&\mbox{o√π : }&\varphi(\xi) = \bma{c} f(x,u) \\ 0 \ema \hu G = \bma{c} 0
\\ I_m \ema \nonumber
\eeqn
The controllability of the augmented system (\ref{augm}), which can be verified
with the previous theorems,  is obviously sufficient to guarantee the controllability 
of the original system.

\section{Trajectory planning}

In the previous sections, we studied the conditions and
criteria that allow to know whether a system is controllable or not.
It is obviously even more interesting to be able to
determine the input function $u(t)$ that effectively allows to lead 
the system from an initial state $x_0$ to a final state $x_f$ in a 
reasonable time. This is the so-called {\it trajectory planning} problem 
that we will explain now.  

\subsection{Brunovski single-input systems}
We consider here the systems affine in the input  $\dot x = f(x) + g(x)u, 
u \in \mathbb{R}$ that can be put in Brunovski form and that are 
characterized by the following theorem :
\begin{theoreme}


A system $\dot x = f(x) + g(x)u$ can be put in Brunovski form
in a domain $U \subset R^n$ if and only if~:
\begin{itemize}
\item[1)] The matrix ${\cal D} = [g(x) \hh ad_fg(x) \hh ad_f^2g(x) \dots
ad_f^{n-1}g(x)]$ is regular $\forall x \in U$;
\item[2)] The distribution $\Delta(x) = \mbox{ span }\{g(x) 
 \dots ad_f^{n-2}g(x)\}$ is involutive in $U$. \qed
\end{itemize}
\end{theoreme}
If these conditions are satisfied, a state transformation exists
$z=\varphi(x)$, $z : U \longrightarrow V$ such that the system
can be rewritten in the triangular form (called Brunovski)~:
\begin{align} \label{bruno}
\dot z_1 &= z_2 \nonumber \\
\dot z_2 &= z_3  \\
&\vdots \nonumber \\
\dot z_n &= \alpha(z) + \beta(z)u \hu \beta(z) \neq 0 \hh \forall z \in
V \nonumber
\end{align}
We deduce immediately from this theorem that a single-input {\it linear system}
$\dot x = Ax + bu$ can be put in Brunovski form if and only if it is 
completely controllable. Indeed, in this case, the matrix ${\cal D}$ is the 
controllability matrix of the system~:
\eqnn
{\cal D} = {\cal C} = [b \hh Ab \hh A^2b \dots A^{(n-1)}b]
\eeqnn
and the distribution $\Delta$ is necessarily involutive since it only 
contains constant vectors. Then there is a {\it linear} state 
transformation~:
\eqnn
z = Tx
\eeqnn
such that the system is rewritten in Brunovski form~:
\eqnn
\dot z_i &=& z_{i+1} \hu i = 1, \dots , n \\
\dot z_n &=& - \sum_{i=1}^n \alpha_i z_i + \beta u
\eeqnn
The matrix $T$ is defined as follow~:
\eqnn
T=\bma{c} h^T \\ h^TA \\ \vdots \\ h^TA^{n-1} \ema
\eeqnn
where the vector $h$ is the last column of the the transpose of the
 inverse of the controllability matrix ${\cal C}^{-T}$.

Once the system, whether it is linear or non-linear, is in Brunovski form,
the problem of trajectory planning becomes very easy to solve. We start 
by showing the solution in the particular case of any system of dimension 
two.

\begin{exemple} {\bf A system of dimension 2}


Let the system be~:
\eqnn
\dot x_1 &=& f_1(x_1,x_2) + g_1(x_1,x_2)u \\
\dot x_2 &=& f_2(x_1,x_2) + g_2(x_1,x_2)u
\eeqnn
The problem is to find an input function $u(t)$ that leads this system from 
an initial state $(x_1(0), x_2(0))$ to a final state $(x_1(T), x_2(T))$.

It is assumed that there is a state transformation~: 
\eqnn z_1 &=& \phi_1(x_1,x_2) \\
z_2 &=& \phi_2(x_1,x_2)
\eeqnn
that puts the system in Brunovski form~:
\eqn
\dot z_1 &=& z_2 \label{bruno1}\\
\dot z_2 &=& \alpha(z_1,z_2) + \beta(z_1,z_2)u \label{bruno2}
\eeqn
Now the problem is to find a function $u(t)$ which leads the system
(\ref{bruno1})-(\ref{bruno2}) from the initial state $z_1(0) =
\phi_1(x_1(0),x_2(0))$, $z_2(0) =
\phi_2(x_1(0),x_2(0))$ to the final state $z_1(T) =
\phi_1(x_1(T),x_2(T))$,  $z_2(T) =
\phi_2(x_1(T),x_2(T))$. 
For the state variable $z_1(t)$,
we define a polymonial trajectory as~:
\eqnn
z_1(t) = \lambda_3(\frac{t}{T})^3 + \lambda_2(\frac{t}{T})^2 +
\lambda_1(\frac{t}{T}) + \lambda_0
\eeqnn
where the coefficients $\lambda_i$ are currently unknown.
We deduce from Brunovski form that the trajectory of $z_2(t)$ must 
have the form~:
\eqnn
z_2(t) = \dot z_1(t) = \frac{3}{T}\lambda_3(\frac{t}{T})^2 + 
\frac{2}{T}\lambda_2(\frac{t}{T}) + \frac{1}{T}\lambda_1
\eeqnn
By clarifying the expressions of $z_1(t)$ et $z_2(t)$ at times $t=0$
and $t=T$, we then obserce that the coefficients $\lambda_i$ are the
solutions of the a linear equation system~:
\eqn
\bma{cccc} 1 & 0 & 0 & 0 \\ 0 & \frac{1}{T} & 0 & 0 \\ 1 & 1 & 1 & 1 \\ 0 &
\frac{1}{T} & \frac{2}{T} & \frac{3}{T} \ema \bma{c} \lambda_0 \\ 
\lambda_1 \\ \lambda_2 \\ \lambda_3 \ema 
= \bma{c} z_1(0) \\ z_2(0) \\ z_1(T) \\ z_2(T) \ema \label{sl}
\eeqn
The $\lambda_i$ being also determined, we know now a trajectory
 $z_1(t), z_2(t)$ which links the desired initial and final states and
we can calculate the corresponding input $u(t)$~: 
\eqnn
u(t) = \frac{\dot z_2(t) - \alpha(z_1(t),z_2(t))}{\beta(z_1(t),z_2(t))}
\eeqnn
with
\eqnn
\dot z_2(t) = \frac{6}{T^2}\lambda_3(\frac{t}{T}) +
\frac{2}{T^2}\lambda_2
\eeqnn
The problem of the trajectory planning is thus solved.
\qed

\end{exemple}
The particular case of a system of dimension $2$ that we just studied is easily generalized in dimension $n$.
Let's recall that we assume that the system is in Brunovski form~:
\eqnn
\dot z_1 &=& z_2 \\
\dot z_2 &=& z_3 \\
&\vdots& \\
\dot z_n &=& \alpha(z) + \beta(z)u \hu \beta(z) \neq 0 
\eeqnn
For $z_1(t)$ it is sufficient to define a polymonial trajectory of the form~:
\eqnn
z_1(t) = \sum_{i=0}^{2n-1} \lambda_i(\frac{t}{T})^{i}
\eeqnn
By calculating the successive derivatives of $z_1(t)$, we obtain the expressions of $z_j(t)$, $j=2,\dots,n$~:
\eqnn
z_j(t) = \sum_{i=j-1}^{2n-1}\frac{i!}{(i-j+1)!}\frac{\lambda_i}{T^{j-1}}(\frac{t}{T})^{-j+1}
\eeqnn
Then by clarifying these expressions at the instants $t=0$ et $t=T$, we obtain a linear equation system that generalizes
the system (\ref{sl}) and makes it possible to calculate the $\lambda_i$. Then only the input $u(t)$ remains to be calculated~:
\eqnn
u(t) = \frac{\dot z_n(t) - \alpha(z(t))}{\beta(z(t))}
\eeqnn

\begin{remarque}


We presented above a solution for the trajectory planning problem based on the use of polynomial functions of order $2n-1$ to generate the trajectories of the system. The choice of such polymonial functions is however nothing imperative. More generally, as it can be easily deduced from the previous developments, we can use linear combinations of $2n-1$ linearly independent arbitrary functions.

\end{remarque}

\subsection{Multi-input linear systems}
We now consider multi-input linear systems of the following form~:
\eqnn
\dot x = Ax + Bu \hspace{6mm} x \in \mathbb{R}^n \hspace{6mm} u \in \mathbb{R}^m
\eeqnn
We assume that the rank($B$) $= m$ and that the system is contrallable. We define the
{\it indices of controllability} $\delta_1, \delta_2, \dots ,
\delta_m$~:
\eqnn
\delta_i = \mbox{ card}[m_j \geq i \,\, : \,\, j \geq 0]
\eeqnn
with
\eqnn
m_0 &=& \mbox{ rank}B\\
m_1 &=& \mbox{ rank}[B,AB] - \mbox{ rank}B\\
\vdots\\
m_{n-1} &=& \mbox{ rank}[B,\dots,A^{n-1}B]-\mbox{ rank}[B, \dots,
A^{n-2}B]
\eeqnn
By definition, we have~:
\eqnn
\delta_1 \geq \delta_2 \geq \dots \geq \delta_m \hspace{4mm} \mbox{and}
\hspace{4mm} \sum_{j=1}^m \delta_j = n
\eeqnn
Then there is a transformation state $z=Tx$ that allows to put the system
in a generalized Brunovski form composed of $m$ blocks each having the 
following triangular form~:
\eqn
\dot z_{j1} &=& z_{j2} \nonumber \\
\dot z_{j2} &=& z_{j3} \nonumber \\
&\vdots& \hspace{2cm} \label{brunomulti}\\
\dot z_{j\delta_{j-1}} &=& z_{j\delta_j} \nonumber\\
\dot z_{j\delta_j} &=&  \bindex {\sum}{j=1,m}{i=1,\delta_j} \alpha_{ji} z_{ji} + \sum_{k=1,m} \beta_{jk} u_k \nonumber
\eeqn
The state vector $z$ is composed of $n$ variables $z_{ji}$, $j=1 \dots m$, $i=1 \dots\delta_j$.
The matrix $G=[\beta_{jk}]$ is squared and invertible. This multi-input form of Brunovski can be use, as in the mono-input case, to solve trajectory planning problems.

\subsection{Brunovski's outputs}
By introducing the notation $y_j = z_{j1}$, the state model \eqref{brunomulti} can also be written under the more compact form
\eqnn
\dot y_{j}^{(\delta_{j}+1)} = \bindex {\sum}{j=1,m}{i=1,\delta_j} \alpha_{ji} y_j^{(i)} + \sum_{k=1,m} \beta_{jk} u_k \hu j=1, \dots , m 
\eeqnn
i.e. under the form of $m$ differential linear equations of order $(\delta_{j}~+1)$. The variables $y_j$ are linear combinations of the state $x$  and are called {\em Brunovski's outputs}. We notice that the number of  Brunovski's outputs is equal to the number of inputs of the system.

\subsection{Multi-input non-linear systems}
Let's now consider a multi-input non-linear system, affine in the input~:
\eqnn
\dot x = f(x) + \sum_{j=1}^m g_j(x)u_j.
\eeqnn
For this system, we can extend the concept of the Brunovski multi-input form if there exists a non-linear state transformation $z = T(x)$ that allows to put the system under the blok triangular form.
\eqnn
\dot z_{j1} &=& z_{j2} \nonumber \\
\dot z_{j2} &=& z_{j3} \nonumber \\
&\vdots& \hspace{2cm} \hu \hu j= 1, \dots, m\\
\dot z_{j\delta_{j-1}} &=& z_{j\delta_j} \nonumber\\
\dot z_{j\delta_j} &=&   \alpha_{j} (z) + \sum_{k=1,m} \beta_{jk}(z) u_k \nonumber
\eeqnn
where the state vector $z$ is composed of $n$ variables $z_{ji}$, $j=1 \dots m$, $i=1 \dots\delta_j$ and the square matrix $G(z) = [\beta_{jk}(z)]$  is invertible. In this case, Brunovski's outputs are non-linear function of the state ($y_j = z_{1j} = h_j(x)$) and the model can be written as the following system of non-linear differential equations  
\eqn
\dot y_{j}^{(\delta_{j}+1)} = \alpha_{j} (z) + \sum_{k=1,m} \beta_{jk}(z) u_k \hu j=1, \dots , m \label{brunomultinonlin}
\eeqn
where the vector $z$ is now defined as follows :
\eqnn
z = (y_1, \dot y_1, \dots, y_1^{(\delta_1)},  \dots, y_m, \dot y_m, \dots , y_m^{(\delta_m)}).
\eeqnn
Contrary to the linear case, the contrallable non-linear systems cannot always be written as the Brunovski multi-input form. It is beyond the scope of this paper to discuss the conditions under which the transformation is possible. This is as a matter of fact an issue that is not fully clarified and which is still the subject of active research at this time. We will only present the two examples below. The first is a simple example where the system is naturally in Brunovski multi-input form   (\ref{brunomultinonlin}). The second example is more complex. It will show a controllable system for which it is necessary, by a {\em dynamic extension}, to use an expanded Brunovski form whose size is greater than the dimension of the system itself.

\begin{exemple} {\bf A manipulator robot}


We consider again the model of the manipulator robot with two degrees of freedom that we studied in chapter 2 (Example 2.2). In examining the model, we easily observe that it is straight away given in a Brunovski multi-input form with the two position coordinates $y_1 = x_1$ et $y_2 = \theta_2$ as Brunovski's outputs.  To prevent explicitly inverting  the inertia matrix, we can write the model in a matrix format as follows :
\eqnn
\left(\begin{array}{c}\ddot y_1 \\\ddot y_2\end{array}\right) = \left(\begin{array}{cc}m_1 + m_2 & m_2b\cos y_2 \\m_2b \cos y_2 & I_2 + m_2b^2\end{array}\right)^{-1}  \left(\begin{array}{c}m_2b \dot y_2^2 \sin y_2 + u_1 \\-m_2bg_o \sin y_2 +u_2 \end{array}\right).
\eeqnn
The controllability indices are here $\delta_1$ = $\delta_2$ = 2. . The matrix $G(z)$ is the inverse of the intertia matrix. 
\qed

\end{exemple}

\begin{exemple}{\bf Rocket dynamics}


In chapter 2 (Exemple 2.1), we established the dynamic model of a rocket as follows :
\begin{itemize}
\item Translational equations
\eqnn
m\ddot{x} &=& (F_1 + F_2)\cos\theta \\ 
m\ddot{y} &=& (F_1 + F_2)\sin\theta - mg_0 
\eeqnn
\item Rotational equations
\eqnn
I\ddot{\theta} = (F_2 - F_1)d\sin\alpha 
\eeqnn
\end{itemize}
\noindent 
In these equations, $(x,y)$ is the position of the centre of mass of the rocket, $\theta$ the angle of the rocket relative to the horizontal, $F_{1}$ and $F_{2}$ the thrusts of the engines, $m$ the weight of the rocket, $I$ its moment of inertia, $d$ and $\alpha$ some geometric parameters and $g_0$ the gravitational acceleration. To simplify the writing without loss of generality,  we define the inputs
\eqnn
u_1 = \dfrac{F_1 + F_2}{m}, \hu u_2 = \dfrac{(F_2 - F_1)d \sin\alpha}{I}.
\eeqnn

With these notations, the state model is simply written~:
\begin{align*}
\ddot x &= u_1 \cos \theta \\
\ddot y &= u_1 \sin \theta - g_0 \\
\ddot \theta &= u_2
\end{align*}

\end{exemple}
This system is fully controllable according to the Theorem 10.10. Intuitively, we might think that the coordinates $x$ and $y$ are Brunovski's outputs. We will see that this intuition is justified, but it involves an extended definition of the concept of Brunovski form. 

Let's calculate the third derivatives of the coordinates $x$ and $y$ :
\begin{align*}
\stackrel{\dots}{x} &= \dot u_1 \cos \theta - u_1 \dot \theta \sin \theta \\
\stackrel{\dots}{y} &= \dot u_1 \sin \theta + u_1 \dot \theta \cos \theta
\end{align*}
It is clear that these expressions can not be used to build a Brunovski form such as \eqref{brunomultinonlin} because they do not contain the input $u_2$. However, if we consider the input $u_1$ as an additional state variable and add two integrators in the system input, then we can show that the extended system has a multi-input Brunovski form with the coordinates $y_1 = x$ and $y_2 = y$ as Brunovski's outputs. The extended system can be written in the following format :

\begin{align} \label{etendufusee}
&\ddot x = u_1 \cos \theta \nonumber \\
&\ddot y = u_1 \sin \theta \nonumber \\
&\ddot \theta = u_2 \\
&\ddot u_1 = w_1 \nonumber
\end{align}
This is a system of 8 dimensions (while the original system was a 6 dimension system) with two entries $w_1$ and $w_2$. Calculate the fourth derivative of the Brunovski outputs $x$ and $y$ : 
\begin{align}
&\left(\begin{array}{c}\stackrel{....}{x} \\ \stackrel{....}{y} \end{array}\right) = \left(\begin{array}{c}-2\dot u_1 \dot \theta \sin \theta - u_1 \dot \theta^2 \cos \theta 
 \\ 2\dot u_1 \dot \theta \cos \theta + u_1 \dot \theta^2 \sin \theta\end{array}\right) \nonumber \\
&\hspace{4cm} + \left(\begin{array}{cc}\cos \theta & -u_1 \sin \theta \\\sin \theta & u_1 \cos \theta\end{array}\right)\left(\begin{array}{c}w_1 \\u_2\end{array}\right). \label{brunofusee}
\end{align}
It's now clear that the system can be written in a form of multi-input Brunovski :
\eqnn
\left(\begin{array}{c}\stackrel{....}{y_1} \\\stackrel{....}{y_2} \end{array}\right) = \alpha(z) + G(z) \left(\begin{array}{c}w_1 \\u_2\end{array}\right).
\eeqnn
Indeed, from the state model \eqref{etendufusee}, the different terms appearing in the equation \eqref{brunofusee} can be expressed (after some calculations !) as a function of Brunovski outputs  $y_1 = x$ et $y_2 = y$ and to their derivatives, as follows :

\eqnn
 u_1 \cos \theta = \ddot y_1, \hu  u_1 \sin \theta = \ddot y_2 + g_o,
 \eeqnn
 \eqnn
\sin \theta = \dfrac{ \ddot y_2 + g_o}{\sqrt{ \ddot y_1^2 + ( \ddot y_2 + g_o)^2}}, \hu \cos \theta = \dfrac{ \ddot y_1}{\sqrt{ \ddot y_1^2 + ( \ddot y_2 + g_o)^2}}, 
\eeqnn
\eqnn
\dot \theta = \dfrac {\ddot y_1 \stackrel{...}{y_2} - (\ddot y_2 + g_o) \stackrel{...}{y_1} } {\ddot y_1^2 + ( \ddot y_2 + g_o)^2 }, 
\eeqnn
\eqnn
\dot u_1 \cos \theta = \stackrel{...}{y_1} + \dot \theta (\ddot y_2 + g_o), \hu \dot u_1 \sin \theta = \stackrel{...}{y_2} - \dot \theta \ddot y_1.
\eeqnn

On the other hand, the matrix 
D'autre part, la matrice
\eqnn
G(z) = \left(\begin{array}{cc}\cos \theta & -u_1 \sin \theta \\\sin \theta & u_1 \cos \theta\end{array}\right)
\eeqnn
is non-singular for all $\theta$ and for all $u_1 \neq 0$ (i.e. as long as the total thrust $F_1 + F_2$ provided by the rocket engines is different of zero) \qed \\

The non-linear systems which may be written in the form of mutli-inputs Brunovski form, thanks to a possible dynamic extension, are called in the literature, {\em (differentially) flat system}, because they are in a sense, equivalent to linear systems as showed by the computation of the planning trajectory. For this reason, the Brunovski outputs are sometimes called {\em flat ouputs}.

%\section{Appendix : Differential Geometry Formulas}

\begin{enumerate}
\item Vector field
\eqnn
f(x) = \bma{c} f_1(x)\\ f_2(x) \\ \vdots \\ f_n(x) \ema
\eeqnn
\vspace{5mm}
\item Lie algebra
\eqnn
[ f(x) , g(x) ] &=& \dfrac{\partial g(x)}{\partial x} f(x) - \dfrac{\partial f(x)}{\partial x} g(x) \\ && \\  \left[ f(x) , g(x) \right] &=& - [ g(x) , f(x) ]
\eeqnn
\vspace{5mm}
\item Iterative Notation
\eqnn
ad_fg &=& [f,g] \\ && \\
ad_f^2g &=& [f,ad_fg] = [f, [f,g]] \\
&\vdots& \\
ad_f^kg &=& [f, ad_f^{k-1}g]
\eeqnn
\vspace{5mm}
\item Distribution = set of vector fields
\eqnn
\Delta(x) = \span \left\{ f_1(x), f_2(x), \hdots , f_d(x) \right\}
\eeqnn
\vspace{5mm}
\item Distribution $\Delta$ is {\em involutive} if
$[f_1,f_2] \in \Delta \;\; \forall \;\; f_1 \in \Delta \; , \; f_2 \in \Delta$
\vspace{5mm}
\item Distribution $\Delta$ is {\em invariant} in relation to $g$ if
\eqnn
\forall \;\; f \in \Delta \;\; \Rightarrow \;\; [g,f] \in \Delta
\eeqnn
\end{enumerate}

\section{Exercises}

\begin{exercice}{\bf \em A hot-air ballon \footnote{Problem from "Analyse et commande de syst√®mes dynamiques"  by F. Bonnans et P. Rouchon, Manual of 'Ecole Polytechnique' (France), 2003 edition.}}

We consider the following model for a hot-air ballon : 
\eqnn
\dot\theta &=& -\frac{1}{\tau_1}\theta + u\\
\dot v &=&  -\frac{1}{\tau_2}v+\sigma\theta \\
\dot h &=& v
\eeqnn
o√π $\theta$ est l'√©cart de temp√©rature de l'air par rapport √† la
temp√©rature d'√©quilibre,\\
$u$ est la commande (proportionnelle √† la quantit√© d'√©nergie
utilis√©e pour chauffer l'air du ballon),\\
$v$ est la vitesse verticale (vitesse ascensionnelle),\\
$h$ est la hauteur.

\begin{enumerate}
\item Commenter les √©quations. 
\item Le syst√®me est-il commandable ?
\item Planifier une trajectoire de $\bma{c}0\\0\\h_0\ema $ √†
$\bma{c}0\\0\\h_1\ema $ \ en $T=1$.
\end{enumerate}

\end{exercice}

\vspace*{3cm}
\begin{exercice}{\bf \em Un r√©acteur biochimique}


Soit un r√©acteur √† volume constant (unitaire) aliment√© en r√©actif
$A$ (d√©bit $d$, concentration $x^{in}_A$) dans lequel se d√©roule
la r√©action
$$
A+B \rightarrow 2B+C$$ La cin√©tique de la r√©action est donn√©e par
la loi d'action des masses.
\begin{enumerate}
\item Donner une repr√©sentation d'√©tat du syst√®me r√©actionnel.
\item Trouver, si c'est possible, un diff√©omorphisme mettant en
√©vidence les modes non commandables du syst√®me.  Examiner les 2
cas suivants : \subitem La commande est $d$ \subitem La commande
est $x^{in}_A$
\end{enumerate}

\end{exercice}


\vspace*{2mm}
\begin{exercice}{\bf \em Contr√¥le d'attitude d'un satellite}

Le contr√¥le de l'orientation d'un satellite (appel√© contr√¥le d'attitude) peut avoir divers objectifs : pointer une antenne, un appareil de mesure ou un panneau solaire dans la bonne direction, √©viter la d√©terioration par les rayons solaires d'√©l√©ments sensibles, orienter le satellite en vue de manoeuvres orbitales etc...

On consid√®re un satellite dans l'espace dont les √©quations du
mouvement s'√©crivent : 
\eqnn \dot x_1 &=& a_1x_2x_3+b_1u_1\\
\dot x_2 &=& a_2x_1x_3+b_2 u_2\\
\dot x_3 &=& a_3x_1x_2
\eeqnn
Etudier la commandabilit√© locale (Th√©or√®me 10.9) de ce syst√®me ($a_i \neq 0 \; b_i \neq 0$).
\end{exercice}

\newpage
\begin{exercice}{\bf \em Un plongeur\footnote{Probl√®me extrait de "Analyse et commande de syst√®mes dynamiques" par F. Bonnans et P. Rouchon, Manuel de l' Ecole Polytechnique (France), √©dition de 2003.}}


On consid√®re le mod√®le ci-dessous d√©crivant la dynamique verticale
d'un plongeur √©quip√© d'un gilet stabilisateur contenant une
quantit√© r√©glable d'air, not√©e $q$ (exprim√©e en moles):
\eqnn
M\frac{d^2h}{dt^2} &=& Mg- \rho g\left(V_0+\frac{qRT}{P_0+ \rho h}\right)\\
\frac{dq}{dt} &=&u 
\eeqnn
avec les notations suivantes : \\

$h$ \;\;\;  : \;\; profondeur du plongeur mesur√©e
positivement depuis la surface
\eqnn \hspace{-3.4 cm} \left.
\begin{tabular}{lll}
$M$&:& masse du plongeur\\
$P_0$ &:& pression atmosph√©rique \\
$T$ &:& temp√©rature\\
$R$ &:&  constante de Boltzmann\\
$\rho$ &:& masse sp√©cifique de l'eau\\
$V_0$&:& volume du plongeur
\end{tabular}
\right\} \mbox{constantes}\\
\eeqnn
 La premi√®re √©quation est un bilan de force selon l'axe vertical.
 Ce bilan comprend la pouss√©e d'Archim√®de $pg(V_0+V_g)$ o√π $V_g$
 est le volume du gilet obtenu en fonction de la pression
 $p=P_0+ \rho h$ par la loi des gaz parfaits $PV=qRT$.

 La deuxi√®me √©quation repr√©sente le remplissage du gilet par l'air
 des bouteilles $(u>0)$ ou la purge du gilet $(u>0)$.
 \begin{enumerate}
 \item Montrer que le syst√®me peut √™tre mis sous forme de
 Brunovski.
 \item Montrer que le syst√®me est commandable.
 \item On d√©sire remonter de fa√ßon contr√¥l√©e entre deux paliers
 stabilis√©s.  Le palier de d√©part $(t=0)$ est √† la profondeur
 $\bar h_1$.  Le palier d'arriv√©e $(t=t_f)$ est √† la profondeur
 $\bar h_2$.  Indiquer comment calculer l'entr√©e $u(t)$ qui assure
 la transition entre ces ceux √©quilibres.
 \end{enumerate}

\end{exercice}

\vspace*{2mm}
\begin{exercice}{\bf \em Un robot sauteur}


On consid√®re un \og robot sauteur \fg \; sch√©matis√© comme ci-dessous.
Ce robot est form√© d'un corps de masse $M$ muni d'une jambe de
masse $m$.  
\begin{figure}[h]
\begin{center}
\includegraphics{robsauteur}
\end{center}
\end{figure}

\noindent La jambe est articul√©e et on peut en contr\^oler
l'orientation $\varphi$ et l'extension
$z$.
La conservation du moment angulaire autour du centre de masse instantan√©
s'√©crit ($d$= constante) :
\eqnn
M\dot \theta + m (z + d)^2(\dot\theta + \dot \varphi)=0
\eeqnn
Les deux entr√©es de commande du syst√®me sont les vitesses d'orientation et
d'√©longation de la jambe.
$$
u_1 = \dot \varphi \;\;\; (2) \hspace*{1cm} u_2 = \dot z \;\;\; (3)
$$
\begin{enumerate}
\item Ecrire les 3 √©quations (1) √† (3) sous la forme d'un mod√®le d'√©tat
dont les entr√©es sont $u_1$ et $u_2$.
\item Examiner si le syst√®me d√©crit par ce mod√®le est compl√®tement
commandable.
\end{enumerate}

\end{exercice}

\end{document}